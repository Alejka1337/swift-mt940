<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Revolut ‚Üí MT940 Converter</title>
  <style>
    :root {
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --border: #e2e8f0;
      --text: #1e293b;
      --radius: 10px;
      --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 420px;
      transition: all 0.3s ease;
    }

    h1 {
      font-size: 1.4rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    label {
      font-weight: 500;
      font-size: 0.95rem;
    }

    input[type="text"],
    input[type="password"],
    input[type="file"] {
      padding: 0.6rem 0.8rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.95rem;
      transition: border 0.2s;
    }

    input:focus {
      border-color: var(--primary);
      outline: none;
    }

    button {
      background: var(--primary);
      color: white;
      padding: 0.8rem;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: background 0.2s, transform 0.1s;
    }

    button:hover {
      background: var(--primary-hover);
    }

    button:active {
      transform: scale(0.98);
    }

    .result {
      margin-top: 1rem;
      text-align: center;
    }

    .success {
      background: #dcfce7;
      color: #166534;
      padding: 0.8rem;
      border-radius: var(--radius);
      font-weight: 500;
    }

    .error {
      background: #fee2e2;
      color: #991b1b;
      padding: 0.8rem;
      border-radius: var(--radius);
      font-weight: 500;
    }

    footer {
      text-align: center;
      font-size: 0.85rem;
      color: #64748b;
      margin-top: 1.5rem;
    }

    #loginForm {
      display: none;
    }

    #uploadForm {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí± Revolut ‚Üí MT940 Converter</h1>

    <!-- –õ–û–ì–ò–ù -->
    <form id="loginForm">
      <label for="username">–õ–æ–≥–∏–Ω</label>
      <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required />

      <label for="password">–ü–∞—Ä–æ–ª—å</label>
      <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required />

      <button type="submit">–í–æ–π—Ç–∏</button>
    </form>

    <!-- –ö–û–ù–í–ï–†–¢–ï–† -->
    <form id="uploadForm">
      <label for="iban">IBAN —Å—á—ë—Ç–∞</label>
      <input type="text" id="iban" name="iban" placeholder="LT34 3250 0093 2332 1491" required />

      <label for="file">–ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV-–≤—ã–ø–∏—Å–∫—É</label>
      <input type="file" id="file" name="file" accept=".csv" required />

      <button type="submit">–°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ MT940</button>
    </form>

    <div id="result" class="result"></div>

    <footer>¬© 2025 Revolut to MT940 | FastAPI + JS</footer>
  </div>

  <script>
    const loginForm = document.getElementById('loginForm');
    const uploadForm = document.getElementById('uploadForm');
    const result = document.getElementById('result');

    const VALID_USER = 'admin';
    const VALID_PASS = '1234';

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';

    if (isLoggedIn) {
      showConverter();
    } else {
      showLogin();
    }

    function showLogin() {
      loginForm.style.display = 'flex';
      uploadForm.style.display = 'none';
    }

    function showConverter() {
      loginForm.style.display = 'none';
      uploadForm.style.display = 'flex';
    }

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();

      if (username === VALID_USER && password === VALID_PASS) {
        localStorage.setItem('isLoggedIn', 'true');
        showConverter();
      } else {
        result.innerHTML = '<div class="error">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.</div>';
      }
    });

    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      result.innerHTML = '';

      const file = document.getElementById('file').files[0];
      const iban = document.getElementById('iban').value;

      if (!file) {
        result.innerHTML = '<div class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ CSV-—Ñ–∞–π–ª.</div>';
        return;
      }

      const formData = new FormData();
      formData.append('file', file);
      formData.append('iban', iban);

      try {
        const res = await fetch('/convert', { method: 'POST', body: formData });
        if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞');

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mt940.txt';
        a.click();

        result.innerHTML = '<div class="success">‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω.</div>';
      } catch (err) {
        result.innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏.</div>';
      }
    });
  </script>
</body>
</html>
